
THREE.SpriteCanvasMaterial=function(a){THREE.Material.call(this);this.type="SpriteCanvasMaterial";this.color=new THREE.Color(16777215);this.program=function(c,b){};this.setValues(a)};THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial;THREE.SpriteCanvasMaterial.prototype.clone=function(){var a=new THREE.SpriteCanvasMaterial();a.copy(this);a.color.copy(this.color);a.program=this.program;return a};THREE.CanvasRenderer=function(G){console.log("THREE.CanvasRenderer",THREE.REVISION);G=G||{};var y=this,D,I,n,a=new THREE.Projector(),j=G.canvas!==undefined?G.canvas:document.createElement("canvas"),B=j.width,aC=j.height,ak=Math.floor(B/2),L=Math.floor(aC/2),c=0,b=0,aE=B,A=aC,p=1,g=j.getContext("2d",{alpha:G.alpha===true}),J=new THREE.Color(0),ay=G.alpha===true?0:1,aD=1,aA=0,z=null,az=null,N=null,l=null,av=null,S=[],aL,aj,ai,ag,af,ae=new THREE.RenderableVertex(),ac=new THREE.RenderableVertex(),x,w,f,d,aK,aI,ax,aw,X,V,R,P,h=new THREE.Color(),t=new THREE.Color(),s=new THREE.Color(),r=new THREE.Color(),q=new THREE.Color(),aa=new THREE.Color(),u=new THREE.Color(),ar=new THREE.Color(),K={},ab,k,aJ,aG,au,aq,W,U,aN=new THREE.Box2(),v=new THREE.Box2(),C=new THREE.Box2(),aF=new THREE.Color(),F=new THREE.Color(),ah=new THREE.Color(),m=new THREE.Vector3(),aO=new THREE.Vector3(),Z=new THREE.Vector3(),Q=new THREE.Matrix3();if(g.setLineDash===undefined){g.setLineDash=function(){}}this.domElement=j;this.autoClear=true;this.sortObjects=true;this.sortElements=true;this.info={render:{vertices:0,faces:0}};this.supportsVertexTextures=function(){};this.setFaceCulling=function(){};this.getContext=function(){return g};this.getContextAttributes=function(){return g.getContextAttributes()};this.getPixelRatio=function(){return p};this.setPixelRatio=function(aQ){if(aQ!==undefined){p=aQ}};this.setSize=function(aR,aQ,aS){B=aR*p;aC=aQ*p;j.width=B;j.height=aC;ak=Math.floor(B/2);L=Math.floor(aC/2);if(aS!==false){j.style.width=aR+"px";j.style.height=aQ+"px"}aN.min.set(-ak,-L);aN.max.set(ak,L);v.min.set(-ak,-L);v.max.set(ak,L);aD=1;aA=0;z=null;az=null;N=null;l=null;av=null;this.setViewport(0,0,aR,aQ)};this.setViewport=function(aR,aT,aS,aQ){c=aR*p;b=aT*p;aE=aS*p;A=aQ*p};this.setScissor=function(){};this.enableScissorTest=function(){};this.setClearColor=function(aQ,aR){J.set(aQ);ay=aR!==undefined?aR:1;v.min.set(-ak,-L);v.max.set(ak,L)};this.setClearColorHex=function(aQ,aR){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead.");this.setClearColor(aQ,aR)};this.getClearColor=function(){return J};this.getClearAlpha=function(){return ay};this.getMaxAnisotropy=function(){return 0};this.clear=function(){if(v.empty()===false){v.intersect(aN);v.expandByScalar(2);v.min.x=v.min.x+ak;v.min.y=-v.min.y+L;v.max.x=v.max.x+ak;v.max.y=-v.max.y+L;if(ay<1){g.clearRect(v.min.x|0,v.max.y|0,(v.max.x-v.min.x)|0,(v.min.y-v.max.y)|0)}if(ay>0){an(THREE.NormalBlending);E(1);al("rgba("+Math.floor(J.r*255)+","+Math.floor(J.g*255)+","+Math.floor(J.b*255)+","+ay+")");g.fillRect(v.min.x|0,v.max.y|0,(v.max.x-v.min.x)|0,(v.min.y-v.max.y)|0)}v.makeEmpty()}};this.clearColor=function(){};this.clearDepth=function(){};this.clearStencil=function(){};this.render=function(aV,aT){if(aT instanceof THREE.Camera===false){console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");return}if(this.autoClear===true){this.clear()}y.info.render.vertices=0;y.info.render.faces=0;g.setTransform(aE/B,0,0,-A/aC,c,aC-b);g.translate(ak,L);D=a.projectScene(aV,aT,this.sortObjects,this.sortElements);I=D.elements;n=D.lights;aL=aT;Q.getNormalMatrix(aT.matrixWorldInverse);ap();for(var aU=0,aS=I.length;aU<aS;aU++){var aQ=I[aU];var aR=aQ.material;if(aR===undefined||aR.opacity===0){continue}C.makeEmpty();if(aQ instanceof THREE.RenderableSprite){aj=aQ;aj.x*=ak;aj.y*=L;o(aj,aQ,aR)}else{if(aQ instanceof THREE.RenderableLine){aj=aQ.v1;ai=aQ.v2;aj.positionScreen.x*=ak;aj.positionScreen.y*=L;ai.positionScreen.x*=ak;ai.positionScreen.y*=L;C.setFromPoints([aj.positionScreen,ai.positionScreen]);if(aN.isIntersectionBox(C)===true){at(aj,ai,aQ,aR)}}else{if(aQ instanceof THREE.RenderableFace){aj=aQ.v1;ai=aQ.v2;ag=aQ.v3;if(aj.positionScreen.z<-1||aj.positionScreen.z>1){continue}if(ai.positionScreen.z<-1||ai.positionScreen.z>1){continue}if(ag.positionScreen.z<-1||ag.positionScreen.z>1){continue}aj.positionScreen.x*=ak;aj.positionScreen.y*=L;ai.positionScreen.x*=ak;ai.positionScreen.y*=L;ag.positionScreen.x*=ak;ag.positionScreen.y*=L;if(aR.overdraw>0){am(aj.positionScreen,ai.positionScreen,aR.overdraw);am(ai.positionScreen,ag.positionScreen,aR.overdraw);am(ag.positionScreen,aj.positionScreen,aR.overdraw)}C.setFromPoints([aj.positionScreen,ai.positionScreen,ag.positionScreen]);if(aN.isIntersectionBox(C)===true){aP(aj,ai,ag,0,1,2,aQ,aR)}}}}v.union(C)}g.setTransform(1,0,0,1,0,0)};function ap(){aF.setRGB(0,0,0);F.setRGB(0,0,0);ah.setRGB(0,0,0);for(var aS=0,aT=n.length;aS<aT;aS++){var aR=n[aS];var aQ=aR.color;if(aR instanceof THREE.AmbientLight){aF.add(aQ)}else{if(aR instanceof THREE.DirectionalLight){F.add(aQ)}else{if(aR instanceof THREE.PointLight){ah.add(aQ)}}}}}function e(aQ,aX,aU){for(var aT=0,aW=n.length;aT<aW;aT++){var aS=n[aT];ar.copy(aS.color);if(aS instanceof THREE.DirectionalLight){var aR=m.setFromMatrixPosition(aS.matrixWorld).normalize();var aV=aX.dot(aR);if(aV<=0){continue}aV*=aS.intensity;aU.add(ar.multiplyScalar(aV))}else{if(aS instanceof THREE.PointLight){var aR=m.setFromMatrixPosition(aS.matrixWorld);var aV=aX.dot(m.subVectors(aR,aQ).normalize());if(aV<=0){continue}aV*=aS.distance==0?1:1-Math.min(aQ.distanceTo(aR)/aS.distance,1);if(aV==0){continue}aV*=aS.intensity;aU.add(ar.multiplyScalar(aV))}}}}function o(a2,aU,aV){E(aV.opacity);an(aV.blending);var a4=aU.scale.x*ak;var a3=aU.scale.y*L;var aY=0.5*Math.sqrt(a4*a4+a3*a3);C.min.set(a2.x-aY,a2.y-aY);C.max.set(a2.x+aY,a2.y+aY);if(aV instanceof THREE.SpriteMaterial){var aX=aV.map;if(aX!==null){var aW=K[aX.id];if(aW===undefined||aW.version!==aX.version){aW=O(aX);K[aX.id]=aW}if(aW.canvas!==undefined){al(aW.canvas);var a1=aX.image;var aR=a1.width*aX.offset.x;var aQ=a1.height*aX.offset.y;var a0=a1.width*aX.repeat.x;var aZ=a1.height*aX.repeat.y;var aT=a4/a0;var aS=a3/aZ;g.save();g.translate(a2.x,a2.y);if(aV.rotation!==0){g.rotate(aV.rotation)}g.translate(-a4/2,-a3/2);g.scale(aT,aS);g.translate(-aR,-aQ);g.fillRect(aR,aQ,a0,aZ);g.restore()}}else{al(aV.color.getStyle());g.save();g.translate(a2.x,a2.y);if(aV.rotation!==0){g.rotate(aV.rotation)}g.scale(a4,-a3);g.fillRect(-0.5,-0.5,1,1);g.restore()}}else{if(aV instanceof THREE.SpriteCanvasMaterial){aB(aV.color.getStyle());al(aV.color.getStyle());g.save();g.translate(a2.x,a2.y);if(aV.rotation!==0){g.rotate(aV.rotation)}g.scale(a4,a3);aV.program(g);g.restore()}}}function at(aX,aV,aT,aU){E(aU.opacity);an(aU.blending);g.beginPath();g.moveTo(aX.positionScreen.x,aX.positionScreen.y);g.lineTo(aV.positionScreen.x,aV.positionScreen.y);if(aU instanceof THREE.LineBasicMaterial){M(aU.linewidth);ad(aU.linecap);aH(aU.linejoin);if(aU.vertexColors!==THREE.VertexColors){aB(aU.color.getStyle())}else{var aS=aT.vertexColors[0].getStyle();var aQ=aT.vertexColors[1].getStyle();if(aS===aQ){aB(aS)}else{try{var aW=g.createLinearGradient(aX.positionScreen.x,aX.positionScreen.y,aV.positionScreen.x,aV.positionScreen.y);aW.addColorStop(0,aS);aW.addColorStop(1,aQ)}catch(aR){aW=aS}aB(aW)}}g.stroke();C.expandByScalar(aU.linewidth*2)}else{if(aU instanceof THREE.LineDashedMaterial){M(aU.linewidth);ad(aU.linecap);aH(aU.linejoin);aB(aU.color.getStyle());Y([aU.dashSize,aU.gapSize]);g.stroke();C.expandByScalar(aU.linewidth*2);Y([])}}}function aP(aY,aX,aW,aT,aS,aR,aU,aV){y.info.render.vertices+=3;y.info.render.faces++;E(aV.opacity);an(aV.blending);x=aY.positionScreen.x;w=aY.positionScreen.y;f=aX.positionScreen.x;d=aX.positionScreen.y;aK=aW.positionScreen.x;aI=aW.positionScreen.y;T(x,w,f,d,aK,aI);if((aV instanceof THREE.MeshLambertMaterial||aV instanceof THREE.MeshPhongMaterial)&&aV.map===null){aa.copy(aV.color);u.copy(aV.emissive);if(aV.vertexColors===THREE.FaceColors){aa.multiply(aU.color)}h.copy(aF);aO.copy(aY.positionWorld).add(aX.positionWorld).add(aW.positionWorld).divideScalar(3);e(aO,aU.normalModel,h);h.multiply(aa).add(u);aV.wireframe===true?aM(h,aV.wireframeLinewidth,aV.wireframeLinecap,aV.wireframeLinejoin):i(h)}else{if(aV instanceof THREE.MeshBasicMaterial||aV instanceof THREE.MeshLambertMaterial||aV instanceof THREE.MeshPhongMaterial){if(aV.map!==null){var aQ=aV.map.mapping;if(aQ===THREE.UVMapping){k=aU.uvs;ao(x,w,f,d,aK,aI,k[aT].x,k[aT].y,k[aS].x,k[aS].y,k[aR].x,k[aR].y,aV.map)}}else{if(aV.envMap!==null){if(aV.envMap.mapping===THREE.SphericalReflectionMapping){Z.copy(aU.vertexNormalsModel[aT]).applyMatrix3(Q);aJ=0.5*Z.x+0.5;aG=0.5*Z.y+0.5;Z.copy(aU.vertexNormalsModel[aS]).applyMatrix3(Q);au=0.5*Z.x+0.5;aq=0.5*Z.y+0.5;Z.copy(aU.vertexNormalsModel[aR]).applyMatrix3(Q);W=0.5*Z.x+0.5;U=0.5*Z.y+0.5;ao(x,w,f,d,aK,aI,aJ,aG,au,aq,W,U,aV.envMap)}}else{h.copy(aV.color);if(aV.vertexColors===THREE.FaceColors){h.multiply(aU.color)}aV.wireframe===true?aM(h,aV.wireframeLinewidth,aV.wireframeLinecap,aV.wireframeLinejoin):i(h)}}}else{if(aV instanceof THREE.MeshNormalMaterial){Z.copy(aU.normalModel).applyMatrix3(Q);h.setRGB(Z.x,Z.y,Z.z).multiplyScalar(0.5).addScalar(0.5);aV.wireframe===true?aM(h,aV.wireframeLinewidth,aV.wireframeLinecap,aV.wireframeLinejoin):i(h)}else{h.setRGB(1,1,1);aV.wireframe===true?aM(h,aV.wireframeLinewidth,aV.wireframeLinecap,aV.wireframeLinejoin):i(h)}}}}function T(aT,aV,aR,aU,aQ,aS){g.beginPath();g.moveTo(aT,aV);g.lineTo(aR,aU);g.lineTo(aQ,aS);g.closePath()}function aM(aQ,aT,aS,aR){M(aT);ad(aS);aH(aR);aB(aQ.getStyle());g.stroke();C.expandByScalar(aT*2)}function i(aQ){al(aQ.getStyle());g.fill()}function O(aU){if(aU.version===0||aU instanceof THREE.CompressedTexture||aU instanceof THREE.DataTexture){return{canvas:undefined,version:aU.version}}var aW=aU.image;var aQ=document.createElement("canvas");aQ.width=aW.width;aQ.height=aW.height;var aR=aQ.getContext("2d");aR.setTransform(1,0,0,-1,0,aW.height);aR.drawImage(aW,0,0);var aT=aU.wrapS===THREE.RepeatWrapping;var aS=aU.wrapT===THREE.RepeatWrapping;var aV="no-repeat";if(aT===true&&aS===true){aV="repeat"}else{if(aT===true){aV="repeat-x"}else{if(aS===true){aV="repeat-y"}}}return{canvas:g.createPattern(aQ,aV),version:aU.version}}function ao(a8,aV,a5,aU,a2,aS,a4,aT,a1,aR,a0,aQ,aX){var a3=K[aX.id];if(a3===undefined||a3.version!==aX.version){a3=O(aX);K[aX.id]=a3}if(a3.canvas!==undefined){al(a3.canvas)}else{al("rgba( 0, 0, 0, 1)");g.fill();return}var bf,be,bd,bc,ba,a7,aW,bb,a9=aX.offset.x/aX.repeat.x,a6=aX.offset.y/aX.repeat.y,aZ=aX.image.width*aX.repeat.x,aY=aX.image.height*aX.repeat.y;a4=(a4+a9)*aZ;aT=(aT+a6)*aY;a1=(a1+a9)*aZ;aR=(aR+a6)*aY;a0=(a0+a9)*aZ;aQ=(aQ+a6)*aY;a5-=a8;aU-=aV;a2-=a8;aS-=aV;a1-=a4;aR-=aT;a0-=a4;aQ-=aT;aW=a1*aQ-a0*aR;if(aW===0){return}bb=1/aW;bf=(aQ*a5-aR*a2)*bb;be=(aQ*aU-aR*aS)*bb;bd=(a1*a2-a0*a5)*bb;bc=(a1*aS-a0*aU)*bb;ba=a8-bf*a4-bd*aT;a7=aV-be*a4-bc*aT;g.save();g.transform(bf,be,bd,bc,ba,a7);g.fill();g.restore()}function H(a6,aV,a4,aU,a2,aS,a3,aT,a1,aR,a0,aQ,aY){var bc,bb,ba,a9,a7,a5,aW,a8,aZ=aY.width-1,aX=aY.height-1;a3*=aZ;aT*=aX;a1*=aZ;aR*=aX;a0*=aZ;aQ*=aX;a4-=a6;aU-=aV;a2-=a6;aS-=aV;a1-=a3;aR-=aT;a0-=a3;aQ-=aT;aW=a1*aQ-a0*aR;a8=1/aW;bc=(aQ*a4-aR*a2)*a8;bb=(aQ*aU-aR*aS)*a8;ba=(a1*a2-a0*a4)*a8;a9=(a1*aS-a0*aU)*a8;a7=a6-bc*a3-ba*aT;a5=aV-bb*a3-a9*aT;g.save();g.transform(bc,bb,ba,a9,a7,a5);g.clip();g.drawImage(aY,0,0);g.restore()}function am(aW,aT,aV){var aQ=aT.x-aW.x,aU=aT.y-aW.y,aR=aQ*aQ+aU*aU,aS;if(aR===0){return}aS=aV/Math.sqrt(aR);aQ*=aS;aU*=aS;aT.x+=aQ;aT.y+=aU;aW.x-=aQ;aW.y-=aU}function E(aQ){if(aD!==aQ){g.globalAlpha=aQ;aD=aQ}}function an(aQ){if(aA!==aQ){if(aQ===THREE.NormalBlending){g.globalCompositeOperation="source-over"}else{if(aQ===THREE.AdditiveBlending){g.globalCompositeOperation="lighter"}else{if(aQ===THREE.SubtractiveBlending){g.globalCompositeOperation="darker"}}}aA=aQ}}function M(aQ){if(N!==aQ){g.lineWidth=aQ;N=aQ}}function ad(aQ){if(l!==aQ){g.lineCap=aQ;l=aQ}}function aH(aQ){if(av!==aQ){g.lineJoin=aQ;av=aQ}}function aB(aQ){if(z!==aQ){g.strokeStyle=aQ;z=aQ}}function al(aQ){if(az!==aQ){g.fillStyle=aQ;az=aQ}}function Y(aQ){if(S.length!==aQ.length){g.setLineDash(aQ);S=aQ}}};