THREE.OrbitControls=function(O,P){this.object=O;this.domElement=(P!==undefined)?P:document;this.enabled=true;this.target=new THREE.Vector3();this.center=this.target;this.noZoom=false;this.zoomSpeed=1;this.minDistance=22;this.maxDistance=200;this.noRotate=false;this.rotateSpeed=1;this.noPan=false;this.keyPanSpeed=7;this.autoRotate=false;this.autoRotateSpeed=2;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.noKeys=false;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};var aj=this;var Q=0.000001;var G=new THREE.Vector2();var ae=new THREE.Vector2();var W=new THREE.Vector2();var ah=new THREE.Vector2();var Z=new THREE.Vector2();var H=new THREE.Vector2();var ai=new THREE.Vector2();var N=new THREE.Vector2();var J=new THREE.Vector2();var ac=0;var R=0;var M=1;var S=new THREE.Vector3();var U=new THREE.Vector3();var K={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5};var ad=K.NONE;var T={type:"change"};this.rotateLeft=function(a){if(a===undefined){a=ab()}R-=a};this.rotateUp=function(a){if(a===undefined){a=ab()}ac-=a};this.panLeft=function(a){var c=new THREE.Vector3();var b=this.object.matrix.elements;c.set(b[0],b[1],b[2]);c.multiplyScalar(-a);S.add(c)};this.panUp=function(a){var c=new THREE.Vector3();var b=this.object.matrix.elements;c.set(b[4],b[5],b[6]);c.multiplyScalar(a);S.add(c)};this.pan=function(a){var d=aj.domElement===document?aj.domElement.body:aj.domElement;if(aj.object.fov!==undefined){var e=aj.object.position;var b=e.clone().sub(aj.target);var c=b.length();c*=Math.tan((aj.object.fov/2)*Math.PI/180);aj.panLeft(2*a.x*c/d.clientHeight);aj.panUp(2*a.y*c/d.clientHeight)}else{if(aj.object.top!==undefined){aj.panLeft(a.x*(aj.object.right-aj.object.left)/d.clientWidth);aj.panUp(a.y*(aj.object.top-aj.object.bottom)/d.clientHeight)}else{console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")}}};this.dollyIn=function(a){if(a===undefined){a=L()}M/=a};this.dollyOut=function(a){if(a===undefined){a=L()}M*=a};this.update=function(){var d=this.object.position;var a=d.clone().sub(this.target);var c=Math.atan2(a.x,a.z);var b=Math.atan2(Math.sqrt(a.x*a.x+a.z*a.z),a.y);if(this.autoRotate){this.rotateLeft(ab())}c+=R;b+=ac;b=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,b));b=Math.max(Q,Math.min(Math.PI-Q,b));var e=a.length()*M;e=Math.max(this.minDistance,Math.min(this.maxDistance,e));this.target.add(S);a.x=e*Math.sin(b)*Math.sin(c);a.y=e*Math.cos(b);a.z=e*Math.sin(b)*Math.cos(c);d.copy(this.target).add(a);this.object.lookAt(this.target);R=0;ac=0;M=1;S.set(0,0,0);if(U.distanceTo(this.object.position)>0){this.dispatchEvent(T);U.copy(this.object.position)}};function ab(){return 2*Math.PI/60/60*aj.autoRotateSpeed}function L(){return Math.pow(0.95,aj.zoomSpeed)}function aa(a){if(aj.enabled===false){return}a.preventDefault();if(a.button===0){if(aj.noRotate===true){return}ad=K.ROTATE;G.set(a.clientX,a.clientY)}else{if(a.button===1){if(aj.noZoom===true){return}ad=K.DOLLY;ai.set(a.clientX,a.clientY)}else{if(a.button===2){if(aj.noPan===true){return}ad=K.PAN;ah.set(a.clientX,a.clientY)}}}aj.domElement.addEventListener("mousemove",X,false);aj.domElement.addEventListener("mouseup",af,false)}function X(a){if(aj.enabled===false){return}a.preventDefault();var b=aj.domElement===document?aj.domElement.body:aj.domElement;if(ad===K.ROTATE){if(aj.noRotate===true){return}ae.set(a.clientX,a.clientY);W.subVectors(ae,G);aj.rotateLeft(2*Math.PI*W.x/b.clientWidth*aj.rotateSpeed);aj.rotateUp(2*Math.PI*W.y/b.clientHeight*aj.rotateSpeed);G.copy(ae)}else{if(ad===K.DOLLY){if(aj.noZoom===true){return}N.set(a.clientX,a.clientY);J.subVectors(N,ai);if(J.y>0){aj.dollyIn()}else{aj.dollyOut()}ai.copy(N)}else{if(ad===K.PAN){if(aj.noPan===true){return}Z.set(a.clientX,a.clientY);H.subVectors(Z,ah);aj.pan(H);ah.copy(Z)}}}aj.update()}function af(){if(aj.enabled===false){return}aj.domElement.removeEventListener("mousemove",X,false);aj.domElement.removeEventListener("mouseup",af,false);ad=K.NONE}function Y(b){if(aj.enabled===false||aj.noZoom===true){return}var a=0;if(b.wheelDelta){a=b.wheelDelta}else{if(b.detail){a=-b.detail}}if(a>0){aj.dollyOut()}else{aj.dollyIn()}}function ag(b){if(aj.enabled===false){return}if(aj.noKeys===true){return}if(aj.noPan===true){return}var a=false;switch(b.keyCode){case aj.keys.UP:aj.pan(new THREE.Vector2(0,aj.keyPanSpeed));a=true;break;case aj.keys.BOTTOM:aj.pan(new THREE.Vector2(0,-aj.keyPanSpeed));a=true;break;case aj.keys.LEFT:aj.pan(new THREE.Vector2(aj.keyPanSpeed,0));a=true;break;case aj.keys.RIGHT:aj.pan(new THREE.Vector2(-aj.keyPanSpeed,0));a=true;break}if(a){aj.update()}}function I(b){if(aj.enabled===false){return}switch(b.touches.length){case 1:if(aj.noRotate===true){return}ad=K.TOUCH_ROTATE;G.set(b.touches[0].pageX,b.touches[0].pageY);break;case 2:if(aj.noZoom===true){return}ad=K.TOUCH_DOLLY;var c=b.touches[0].pageX-b.touches[1].pageX;var d=b.touches[0].pageY-b.touches[1].pageY;var a=Math.sqrt(c*c+d*d);ai.set(0,a);break;case 3:if(aj.noPan===true){return}ad=K.TOUCH_PAN;ah.set(b.touches[0].pageX,b.touches[0].pageY);break;default:ad=K.NONE}}function V(b){if(aj.enabled===false){return}b.preventDefault();b.stopPropagation();var c=aj.domElement===document?aj.domElement.body:aj.domElement;switch(b.touches.length){case 1:if(aj.noRotate===true){return}if(ad!==K.TOUCH_ROTATE){return}ae.set(b.touches[0].pageX,b.touches[0].pageY);W.subVectors(ae,G);aj.rotateLeft(2*Math.PI*W.x/c.clientWidth*aj.rotateSpeed);aj.rotateUp(2*Math.PI*W.y/c.clientHeight*aj.rotateSpeed);G.copy(ae);break;case 2:if(aj.noZoom===true){return}if(ad!==K.TOUCH_DOLLY){return}var d=b.touches[0].pageX-b.touches[1].pageX;var e=b.touches[0].pageY-b.touches[1].pageY;var a=Math.sqrt(d*d+e*e);N.set(0,a);J.subVectors(N,ai);if(J.y>0){aj.dollyOut()}else{aj.dollyIn()}ai.copy(N);break;case 3:if(aj.noPan===true){return}if(ad!==K.TOUCH_PAN){return}Z.set(b.touches[0].pageX,b.touches[0].pageY);H.subVectors(Z,ah);aj.pan(H);ah.copy(Z);break;default:ad=K.NONE}}function F(){if(aj.enabled===false){return}ad=K.NONE}this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},false);this.domElement.addEventListener("mousedown",aa,false);this.domElement.addEventListener("mousewheel",Y,false);this.domElement.addEventListener("DOMMouseScroll",Y,false);this.domElement.addEventListener("keydown",ag,false);this.domElement.addEventListener("touchstart",I,false);this.domElement.addEventListener("touchend",F,false);this.domElement.addEventListener("touchmove",V,false)};THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);